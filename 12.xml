<?xml version="1.0" encoding="UTF-8" ?>
<Module>
<ModulePrefs title="Google.com" />
<Content type="html"><![CDATA[

<!DOCTYPE html>
<html lang="en-us">
<head>
    <meta charset="utf-8"/>
    <meta http-equiv="Content-Type" content="text/html; charset=utf-8"/>
    <meta name="viewport" content="width=device-width, initial-scale=1.0, user-scalable=no"/>
    <title>FNAF 3D</title>
    <link rel="shortcut icon" href="https://cdn.jsdelivr.net/gh/ragdoi-archers/fasre@main/TemplateData/favicon.ico"/>
    <link rel="stylesheet" href="https://cdn.jsdelivr.net/gh/ragdoi-archers/fasre@main/TemplateData/style.css"/>
    <style>
        /* LOADING EKRANI TAMÄ°R EDÄ°LDÄ° */
        #loading-cover {
            position: fixed !important;
            top: 0 !important; 
            left: 0 !important;
            width: 100vw !important;
            height: 100vh !important;
            background: rgba(0,0,0,0.95) !important;
            display: flex !important;
            justify-content: center !important;
            align-items: center !important;
            z-index: 999999 !important; /* Canvas'Ä±n Ã¼stÃ¼nde */
            pointer-events: auto !important;
            transition: opacity 0.5s ease-out, visibility 0s 0.5s !important;
        }
        
        #loading-cover.hidden {
            opacity: 0 !important;
            visibility: hidden !important;
        }
        
        #unity-progress-bar-empty {
            display: block !important;
            margin: 20px 0 !important;
        }
        
        .spinner {
            display: block !important;
        }
        
        /* Unity canvas loading sÄ±rasÄ±nda gizli */
        #unity-canvas.loading-hidden {
            pointer-events: none !important;
            opacity: 0 !important;
        }
    </style>
</head>
<body class="dark">
    <div id="unity-container" class="unity-desktop">
        <canvas id="unity-canvas" class="loading-hidden"></canvas>
    </div>

    <!-- LOADING SCREEN -->
    <div id="loading-cover">
        <div id="unity-loading-bar">
            <div id="unity-logo">
                <img src="https://cdn.jsdelivr.net/gh/ragdoi-archers/fasre@main/logo.png" alt="Loading..."/>
            </div>
            <div id="unity-progress-bar-empty">
                <div id="unity-progress-bar-full"></div>
            </div>
            <div class="spinner"></div>
        </div>
    </div>

<script>
(async () => {
    // ========== ELEMAN REFERANSLARI ==========
    const progressEmpty = document.getElementById("unity-progress-bar-empty");
    const progressFull  = document.getElementById("unity-progress-bar-full");
    const spinner       = document.querySelector(".spinner");
    const loadingCover  = document.getElementById("loading-cover");
    const canvas        = document.getElementById("unity-canvas");
    const container     = document.getElementById("unity-container");

    // BaÅŸlangÄ±Ã§ ayarlarÄ±
    progressFull.style.width = "0%";
    progressEmpty.style.display = "block";
    spinner.style.display = "block";
    loadingCover.classList.remove("hidden");

    // ========== DATA MERGE ==========
    const buildUrl = "https://cdn.jsdelivr.net/gh/ragdoi-archers/fasre@main/Build";
    const totalParts = 7;
    const partUrls = Array.from({length: totalParts}, (_, i) => `${buildUrl}/Build.data.unityweb.part${i}`);

    console.log("ğŸ“¥ Data parÃ§alarÄ± indiriliyor...");
    
    let responses = [];
    for (let i = 0; i < partUrls.length; i++) {
        try {
            const res = await fetch(partUrls[i]);
            if (!res.ok) throw new Error(`HTTP ${res.status}`);
            const buf = await res.arrayBuffer();
            responses.push(buf);

            // Progress gÃ¼ncelle
            const pct = Math.min(100, ((i + 1) / totalParts) * 100);
            progressFull.style.width = `${pct}%`;
            console.log(`âœ… ParÃ§a ${i+1}/${totalParts} yÃ¼klendi: ${pct.toFixed(0)}%`);
        } catch (err) {
            console.error(`âŒ ${partUrls[i]} yÃ¼klenemedi:`, err);
        }
    }

    let mergedDataUrl = null;
    if (responses.length > 0) {
        const totalSize = responses.reduce((a, b) => a + b.byteLength, 0);
        const mergedArray = new Uint8Array(totalSize);
        let offset = 0;
        for (const part of responses) {
            mergedArray.set(new Uint8Array(part), offset);
            offset += part.byteLength;
        }
        const blob = new Blob([mergedArray]);
        mergedDataUrl = URL.createObjectURL(blob);
        console.log("âœ… Data birleÅŸtirildi:", mergedDataUrl);
        progressFull.style.width = "100%";
    } else {
        console.warn("âš ï¸ Fallback data kullanÄ±lÄ±yor");
    }

    // KÃ¼Ã§Ã¼k bekleme (gÃ¶rsel efekt)
    await new Promise(r => setTimeout(r, 300));

    // ========== UNITY CONFIG ==========
    const loaderUrl = buildUrl + "/Build.loader.js";
    const config = {
        dataUrl: mergedDataUrl || (buildUrl + "/Build.data.unityweb"),
        frameworkUrl: buildUrl + "/Build.framework.js.unityweb",
        codeUrl: buildUrl + "/Build.wasm.unityweb",
        streamingAssetsUrl: "StreamingAssets",
        companyName: "COMEBACK Games",
        productName: "FNAF 3D",
        productVersion: "0.1",
    };

    // Mobil uyum
    if (/iPhone|iPad|iPod|Android/i.test(navigator.userAgent)) {
        container.className = "unity-mobile";
    }

    canvas.style.background = "url('https://cdn.jsdelivr.net/gh/ragdoi-archers/fasre@main/background.jpg') center / cover";
    
    // Focus eventleri
    canvas.addEventListener("touchstart", () => window.focus(), { passive: true });
    canvas.addEventListener("pointerdown", () => window.focus(), { passive: true });

    let myGameInstance = null;

    // ========== SAFE SEND ==========
    function safeSend(object, method, param = "") {
        if (myGameInstance?.SendMessage) {
            try { 
                myGameInstance.SendMessage(object, method, param); 
            } catch (e) { 
                console.warn(`[SafeSend] ${object}.${method}:`, e); 
            }
        }
    }

    // ========== YANDEX STUBS ==========
    const yandexStubs = [
        "InitGame", "InitYandex", "FullAdShow", "RewardedShow", "StickyAdActivity",
        "BuyPayments", "GetPayments", "ConsumePurchase", "ConsumePurchases",
        "SaveCloud", "LoadCloud", "InitLeaderboard", "SetLeaderboardScores",
        "GetLeaderboardScores", "LanguageRequest", "RequestingEnvironmentData",
        "Review", "PromptShow", "PaintRBT", "StaticRBTDeactivate", "OpenAuthDialog",
        "GameReadyAPI", "NotAuthorized", "InitPlayer", "InitPayments"
    ];
    yandexStubs.forEach(name => {
        window[name] = (...args) => console.log(`[Y/STUB] ${name}:`, args);
    });

    // ========== UNITY LOADER ==========
    const script = document.createElement("script");
    script.src = loaderUrl;
    script.onload = async () => {
        try {
            console.log("ğŸš€ Unity baÅŸlatÄ±lÄ±yor...");
            
            const unityInstance = await createUnityInstance(canvas, config, (progress) => {
                // Unity yÃ¼kleme progress
                spinner.style.display = "none";
                progressFull.style.width = `${progress * 100}%`;
            });

            myGameInstance = unityInstance;
            console.log("âœ… Unity hazÄ±r!");

            // LOADING EKRANI TAMAMEN KALDIR â†’ BUTONLAR Ã‡ALIÅACAK!
            loadingCover.classList.add("hidden");
            
            // Canvas'Ä± aktif et
            canvas.classList.remove("loading-hidden");
            
            // Offline baÅŸlatma
            setTimeout(() => {
                safeSend('YandexGame', 'SetInitializationSDK', JSON.stringify({
                    playerAuth: "resolved", playerName: "Player",
                    playerId: "offline_123", playerPhoto: "null"
                }));
                safeSend('YandexGame', 'SetLanguage', 'en');
                const env = {
                    language: "en", domain: "com", deviceType: "desktop",
                    isMobile: false, isDesktop: true, isTablet: false, isTV: false,
                    appID: "offline", browserLang: "en", payload: null,
                    promptCanShow: false, reviewCanShow: false
                };
                safeSend('YandexGame', 'SetEnvironmentData', JSON.stringify(env));
                safeSend('YandexGame', 'SetLoadSaves', "noData");
                safeSend('YandexGame', 'GameReady');
            }, 500);

        } catch (err) {
            console.error("âŒ Unity hatasÄ±:", err);
            alert("Oyun yÃ¼klenemedi: " + err.message);
            loadingCover.innerHTML = "<h2>âŒ YÃ¼kleme HatasÄ±</h2>";
        }
    };
    
    script.onerror = () => {
        alert("Loader yÃ¼klenemedi!");
        loadingCover.innerHTML = "<h2>âŒ BaÄŸlantÄ± HatasÄ±</h2>";
    };
    
    document.head.appendChild(script);

})();
</script>
</body>
</html>

]]></Content>
</Module>